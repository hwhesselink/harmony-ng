import hassapi as hass

import asyncio, time

LOG_LEVEL = "INFO"

# Kincony
REMOTE = 'a1e13b4a8a46c8c156cdde70ee3be970'


urc3680_rc6_keys = {
    0x00: 'KEY_0',
    0x01: 'KEY_1',
    0x02: 'KEY_2',
    0x03: 'KEY_3',
    0x04: 'KEY_4',
    0x05: 'KEY_5',
    0x06: 'KEY_6',
    0x07: 'KEY_7',
    0x08: 'KEY_8',
    0x09: 'KEY_9',
    0x0A: 'KEY_LAST',
    0x0C: 'KEY_POWER',
    0x0D: 'KEY_MUTE',
    0x0F: 'KEY_INFO',
    0x10: 'KEY_VOLUMEUP',
    0x11: 'KEY_VOLUMEDOWN',
    0x20: 'KEY_CHANNELUP',
    0x21: 'KEY_CHANNELDOWN',
    0x28: 'KEY_NEXT',
    0x2B: 'KEY_PREVIOUS',
    0x2C: 'KEY_PLAY',
    0x30: 'KEY_PAUSE',
    0x31: 'KEY_STOP',
    0x37: 'KEY_RECORD',
    0x38: 'KEY_INPUT',
    0x41: 'KEY_BACK',
    0x42: 'KEY_EJECT',
    0x4B: 'KEY_PREVIOUSHELD',
    0x4C: 'KEY_NEXTHELD',
    0x54: 'KEY_HOME',
    0x57: 'KEY_MENU',
    0x58: 'KEY_UP',
    0x59: 'KEY_DOWN',
    0x5A: 'KEY_LEFT',
    0x5B: 'KEY_RIGHT',
    0x5C: 'KEY_OK',
    0x6D: 'KEY_RED',
    0x6E: 'KEY_GREEN',
    0x6F: 'KEY_YELLOW',
    0x70: 'KEY_BLUE',
    0x71: 'KEY_BACKLIGHT',
    0x76: 'KEY_PROG1',
    0x77: 'KEY_PROG2',
    0x79: 'KEY_PROG3',
    0x92: 'KEY_ENTER',
    0x9F: 'KEY_EXIT',
    0xCC: 'KEY_GUIDE',
    0xD2: 'KEY_LIST',
    0xD9: 'KEY_MINUS',
    0xE0: 'KEY_WATCHTV',
    0xE1: 'KEY_LISTENTOMUSIC',
    0xE2: 'KEY_WATCHMOVIES',
    0xE3: 'KEY_WATCHTVHELD',
    0xE4: 'KEY_LISTENTOMUSICHELD',
    0xE5: 'KEY_WATCHMOVIESHELD',
    0xE6: 'KEY_WATCHTVSHIFT',
    0xE7: 'KEY_LISTENTOMUSICSHIFT',
    0xE8: 'KEY_WATCHMOVIESSHIFT',
    0xF0: 'KEY_POWERSHIFT',
    0xF1: 'KEY_LIVE',
    0xF2: 'KEY_REPLAY',
}

rm_vl600_8001_keys = {
    (0x00000010, 12): '1',
    (0x00000070, 12): 'Menu',
    (0x00000090, 12): 'Ch+',
    (0x00000110, 12): '9',
    (0x000001B0, 12): 'FF',
    (0x00000210, 12): '5',
    (0x00000290, 12): 'Muting',
    (0x000002D0, 12): 'Left',
    (0x000002F0, 12): 'Up',
    (0x000003B0, 12): 'Pause',
    (0x00000410, 12): '3',
    (0x00000490, 12): 'Vol+',
    (0x000005B0, 12): 'Record',
    (0x000005D0, 12): 'Info',
    (0x00000610, 12): '7',
    (0x000006D0, 12): 'Sleep',
    (0x00000710, 12): 'Guide',
    (0x000007B0, 12): 'Stop',
    (0x00000810, 12): '2',
    (0x00000890, 12): 'Ch-',
    (0x00000910, 12): '0',
    (0x000009B0, 12): 'Rewind',
    (0x00000A10, 12): '6',
    (0x00000A50, 12): 'TV/Video',
    (0x00000A70, 12): 'Ok',
    (0x00000A90, 12): 'Power',
    (0x00000AF0, 12): 'Down',
    (0x00000C10, 12): '4',
    (0x00000C70, 12): 'Exit',
    (0x00000C90, 12): 'Vol-',
    (0x00000CD0, 12): 'Right',
    (0x00000D10, 12): 'Enter',
    (0x00000DB0, 12): 'Twinview',
    (0x00000DD0, 12): 'Recall',
    (0x00000E10, 12): '8',
    (0x00000FB0, 12): 'Play',
    (0x000036E9, 15): 'Tools',
    (0x00005CE9, 15): 'DOT',
}

# These don't work well
apple_own_cmds = {
    'KEY_BACK': ("BACK", "0000 006C 0022 0002 015B 00AD 0016 0016 0016 0041 0016 0041 0016 0041 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0622 015B 0057 0016 0E6C"),
    'KEY_CHANNELDOWN': ("CHANNEL DOWN", "0000 006C 0022 0002 015B 00AD 0016 0041 0016 0016 0016 0041 0016 0016 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0041 0016 0016 0016 0041 0016 0016 0016 0016 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0622 015B 0057 0016 0E6C"),
    'KEY_CHANNELUP': ("CHANNEL UP", "0000 006C 0022 0002 015B 00AD 0016 0041 0016 0016 0016 0041 0016 0016 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0622 015B 0057 0016 0E6C"),
    'KEY_DOWN': ("CURSOR DOWN", "0000 006C 0022 0002 015B 00AD 0016 0016 0016 0041 0016 0041 0016 0041 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0016 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0622 015B 0057 0016 0E6C"),
    'KEY_OK': ("CURSOR ENTER", "0000 006C 0022 0002 015B 00AD 0016 0016 0016 0041 0016 0041 0016 0041 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0016 0016 0041 0016 0041 0016 0041 0016 0016 0016 0041 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 05CB 015B 0057 0016 0E6C"),
    'KEY_LEFT': ("CURSOR LEFT", "0000 006C 0022 0002 015B 00AD 0016 0016 0016 0041 0016 0041 0016 0041 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0041 0016 0016 0016 0016 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0622 015B 0057 0016 0E6C"),
    'KEY_RIGHT': ("CURSOR RIGHT", "0000 006C 0022 0002 015B 00AD 0016 0016 0016 0041 0016 0041 0016 0041 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0622 015B 0057 0016 0E6C"),
    'KEY_UP': ("CURSOR UP", "0000 006C 0022 0002 015B 00AD 0016 0016 0016 0041 0016 0041 0016 0041 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0622 015B 0057 0016 0E6C"),
    'X': ("DISPLAY", "0000 006C 0022 0002 015B 00AD 0016 0041 0016 0016 0016 0041 0016 0016 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0041 0016 0016 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0622 015B 0057 0016 0E6C"),
    'KEY_NEXTHELD': ("FORWARD", "0000 006C 0022 0002 015B 00AD 0016 0041 0016 0016 0016 0041 0016 0016 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0622 015B 0057 0016 0E6C"),
    'KEY_INFO': ("INFO", "0000 006C 0022 0002 015B 00AD 0016 0041 0016 0016 0016 0041 0016 0016 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0041 0016 0016 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0622 015B 0057 0016 0E6C"),
    'KEY_HOME': ("MENU HOME", "0000 006C 0022 0002 015B 00AD 0016 0041 0016 0016 0016 0041 0016 0016 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0679 015B 0057 0016 0E6C"),
    'KEY_MENU': ("MENU MAIN", "0000 006C 0022 0002 015B 00AD 0016 0016 0016 0041 0016 0041 0016 0041 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0622 015B 0057 0016 0E6C"),
    'X': ("OPTIONS", "0000 006C 0022 0002 015B 00AD 0016 0016 0016 0041 0016 0041 0016 0041 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0016 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0622 015B 0057 0016 0E6C"),
    'KEY_X': ("PAUSE", "0000 006C 0022 0002 015B 00AD 0016 0041 0016 0016 0016 0041 0016 0016 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0622 015B 0057 0016 0E6C"),
    'KEY_PLAY': ("PLAY", "0000 006C 0022 0002 015B 00AD 0016 0041 0016 0016 0016 0041 0016 0016 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0041 0016 0016 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0622 015B 0057 0016 0E6C"),
    'KEY_PAUSE': ("PLAY PAUSE TOGGLE", "0000 006C 0022 0002 015B 00AD 0016 0016 0016 0041 0016 0041 0016 0041 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0041 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0575 015B 0057 0016 0E6C"),
    'X': ("POWER OFF", "0000 006C 0022 0002 015B 00AD 0016 0041 0016 0016 0016 0041 0016 0016 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0622 015B 0057 0016 0E6C"),
    'X': ("POWER ON", "0000 006C 0022 0002 015B 00AD 0016 0041 0016 0016 0016 0041 0016 0016 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0016 0016 0041 0016 0041 0016 0016 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0622 015B 0057 0016 0E6C"),
    'X': ("REBOOT", "0000 006C 0022 0002 015B 00AD 0016 0016 0016 0041 0016 0041 0016 0041 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0016 0016 0016 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0622 015B 0057 0016 0E6C"),
    'KEY_PREVIOUS': ("REPLAY", "0000 006C 0022 0002 015B 00AD 0016 0041 0016 0016 0016 0041 0016 0016 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0041 0016 0016 0016 0016 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0622 015B 0057 0016 0E6C"),
    'KEY_PREVIOUSHELD': ("REVERSE", "0000 006C 0022 0002 015B 00AD 0016 0041 0016 0016 0016 0041 0016 0016 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0016 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0622 015B 0057 0016 0E6C"),
    'X': ("SCREEN SHOT", "0000 006C 0022 0002 015B 00AD 0016 0016 0016 0041 0016 0041 0016 0041 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 05CB 015B 0057 0016 0E6C"),
    'KEY_NEXT': ("SKIP", "0000 006C 0022 0002 015B 00AD 0016 0041 0016 0016 0016 0041 0016 0016 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 05CB 015B 0057 0016 0E6C"),
    'KEY_STOP': ("STOP", "0000 006C 0022 0002 015B 00AD 0016 0016 0016 0041 0016 0041 0016 0041 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0622 015B 0057 0016 0E6C"),
    'X': ("TV+", "0000 006C 0022 0002 015B 00AD 0016 0041 0016 0016 0016 0041 0016 0016 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0679 015B 0057 0016 0E6C"),
    'X': ("VIDEO RESOLUTION", "0000 006C 0022 0002 015B 00AD 0016 0016 0016 0041 0016 0041 0016 0041 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0041 0016 0041 0016 0041 0016 0016 0016 0041 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 0041 0016 0016 0016 05CB 015B 0057 0016 0E6C"),
}

sony_cmds = {
    'KEY_0': ('0', (0x00000910, 12)),
    'KEY_PREVIOUSHELD': ('1', (0x00000010, 12)),
    'KEY_NEXTHELD': ('2', (0x00000810, 12)),
    'KEY_3': ('3', (0x00000410, 12)),
    'KEY_4': ('4', (0x00000C10, 12)),
    'KEY_5': ('5', (0x00000210, 12)),
    'KEY_6': ('6', (0x00000A10, 12)),
    'KEY_7': ('7', (0x00000610, 12)),
    'KEY_8': ('8', (0x00000E10, 12)),
    'KEY_9': ('9', (0x00000110, 12)),
    'KEY_CHANNELUP': ('Ch+', (0x00000090, 12)),
    'KEY_CHANNELDOWN': ('Ch-', (0x00000890, 12)),
    'KEY_MINUS': ('DOT', (0x00005CE9, 15)),
    'KEY_DOWN': ('Down', (0x00000AF0, 12)),
    'KEY_ENTER': ('Enter', (0x00000D10, 12)),
    'KEY_EXIT': ('Exit', (0x00000C70, 12)),
    'KEY_NEXT': ('FF', (0x000001B0, 12)),
    'KEY_GUIDE': ('Guide', (0x00000710, 12)),
    'KEY_INFO': ('Info', (0x000005D0, 12)),
    'KEY_LEFT': ('Left', (0x000002D0, 12)),
    'KEY_MENU': ('Menu', (0x00000070, 12)),
    'KEY_BACK': ('Menu', (0x00000070, 12)),
    'KEY_MUTE': ('Muting', (0x00000290, 12)),
    'KEY_OK': ('Ok', (0x00000A70, 12)),
    'KEY_PAUSE': ('Pause', (0x000003B0, 12)),
    'KEY_PLAY': ('Play', (0x00000FB0, 12)),
    'KEY_POWER': ('Power', (0x00000A90, 12)),
    'KEY_LASTCH': ('Recall', (0x00000DD0, 12)),
    'KEY_RECORD': ('Record', (0x000005B0, 12)),
    'KEY_PREVIOUS': ('Rewind', (0x000009B0, 12)),
    'KEY_RIGHT': ('Right', (0x00000CD0, 12)),
    'KEY_X1': ('Sleep', (0x000006D0, 12)),
    'KEY_STOP': ('Stop', (0x000007B0, 12)),
    'KEY_INPUT': ('TV/Video', (0x00000A50, 12)),
    'KEY_X2': ('Tools', (0x000036E9, 15)),
    'KEY_X3': ('Twinview', (0x00000DB0, 12)),
    'KEY_UP': ('Up', (0x000002F0, 12)),
    'KEY_VOLUMEUP': ('Vol+', (0x00000490, 12)),
    'KEY_VOLUMEDOWN': ('Vol-', (0x00000C90, 12)),
}

lg_cmds = {
    'KEY_LEFT': ('Left', (0x02FDB847, 32)),
    'KEY_UP': ('Up', (0x02FD41BE, 32)),
    'KEY_DOWN': ('Down', (0x02FDC13E, 32)),
    'KEY_RIGHT': ('Right', (0x02FD9867, 32)),
}

nec_cmds = {
    'KEY_LEFT': ('Left', 0xE21D),
    'KEY_UP': ('Up', 0x7D82),
    'KEY_DOWN': ('Down', 0x7C83),
    'KEY_RIGHT': ('Right', 0xE619),
}

pan_dvd_cmds = {
    'KEY_POWER':        ('Power', 0x0D00BCB1),
    'KEY_INFO':         ('Display', 0x0D004944),
    'KEY_EJECT':        ('Open/Close', 0x0D00808D),
    'KEY_1':            ('1', 0x0D000805),
    'KEY_2':            ('2', 0x0D008885),
    'KEY_3':            ('3', 0x0D004845),
    'KEY_4':            ('4', 0x0D00C8C5),
    'KEY_5':            ('5', 0x0D002825),
    'KEY_6':            ('6', 0x0D00A8A5),
    'KEY_7':            ('7', 0x0D006865),
    'KEY_8':            ('8', 0x0D00E8E5),
    'KEY_9':            ('9', 0x0D001815),
    'KEY_0':            ('0', 0x0D009895),
    'KEY_ENTER':        ('>=10', 0x0D00919C),
    'KEY_HOME':         ('Menu Top', 0x0D00D9D4),
    'KEY_UP':           ('Up', 0x0D00A1AC),
    'KEY_MENU':         ('Menu', 0x0D00010C),
    'KEY_LEFT':         ('Left', 0x0D00E1EC),
    'KEY_OK':           ('OK', 0x0D00414C),
    'KEY_RIGHT':        ('Right', 0x0D00111C),
    'KEY_INPUT':        ('Setup', 0x0D002924),
    'KEY_DOWN':         ('Down', 0x0D00616C),
    'KEY_LAST':         ('Return', 0x0D00818C),
    'KEY_PREVIOUS':     ('Skip back', 0x0D00929F),
    'KEY_NEXT':         ('Skip fwd', 0x0D00525F),
    'KEY_PREVIOUSHELD': ('Back', 0x0D00202D),
    'KEY_NEXTHELD':     ('Forward', 0x0D00A0AD),
    'KEY_STOP':         ('Stop', 0x0D00000D),
    'KEY_PLAY':         ('Play/Pause', 0x0D00505D),
    'KEY_PROG1':        ('Frame', 0x0D00303D),
    'KEY_EXIT':         ('Cancel', 0x0D00C1CC),
    'KEY_GREEN':        ('Subtitle', 0x0D008984),
    'KEY_PROGRAM':      ('Program', 0x0D00B2BF),
    'KEY_USB':          ('USB', 0x0D00404D),
    'KEY_REPLAY':       ('Repeat', 0x0D00313C),
    'KEY_BLUE':         ('Audio', 0x0D00CCC1),
    '#Search Mode':     ('Search Mode', 0x0D00676A),
    '#A-B Repeat':      ('A-B Repeat', 0x0D00121F),
    '#Slow':            ('Slow', 0x0D00F0FD),
    '#Random/Angle':    ('Random/Angle', 0x0D000904),
    '#Zoom':            ('Zoom', 0x0D00838E),
    '#USB Rec':         ('USB Rec', 0x0D00515C),
}

cisco8742_cmds = {
    'KEY_POWER': ('Power', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0090 0030 0090 0030 0090 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0090 0030 0090 0030 0090 0030 09E6'),
    'KEY_LIVE': ('Live', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0030 0030 0090 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 09E6'),
    'KEY_MINUS': ('CC', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0090 0030 0090 0030 0090 0030 0090 0030 0030 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0090 0030 09E6'),
    'KEY_PLAY': ('Play', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0090 0030 0090 0030 0030 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 09E6'),
    'KEY_PREVIOUS': ('<<', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 0090 0030 0030 0030 0090 0030 0030 0030 09E6'),
    'KEY_NEXT': ('>>', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0090 0030 0090 0030 0030 0030 0090 0030 0030 0030 09E6'),
    'KEY_PAUSE': ('Pause', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0090 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0090 0030 0090 0030 0090 0030 09E6'),
    'KEY_REPLAY': ('Replay', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0090 0030 0090 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0090 0030 0090 0030 0030 0030 09E6'),
    'KEY_STOP': ('Stop', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0090 0030 0030 0030 0090 0030 0030 0030 0030 0030 09E6'),
    'KEY_RECORD': ('Record', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0090 0030 0030 0030 0090 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0090 0030 0030 0030 0030 0030 09E6'),
    'KEY_INFO': ('Info', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 09E6'),
    'KEY_UP': ('Up', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0090 0030 0090 0030 0090 0030 0090 0030 09E6'),
    'KEY_OK': ('OK', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0090 0030 0090 0030 09E6'),
    'KEY_RIGHT': ('Right', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0090 0030 09E6'),
    'KEY_LEFT': ('Left', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0090 0030 0090 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0030 0030 0090 0030 0090 0030 0090 0030 0090 0030 09E6'),
    'KEY_DOWN': ('Down', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0090 0030 0090 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0090 0030 0090 0030 09E6'),
    'KEY_EXIT': ('Exit', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0090 0030 0090 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 09E6'),
    'KEY_YELLOW': ('Yellow', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0090 0030 0090 0030 0090 0030 0090 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 09E6'),
    'KEY_BLUE': ('Blue', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0030 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0090 0030 0090 0030 0090 0030 0030 0030 0030 0030 09E6'),
    'KEY_RED': ('Red', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 0090 0030 0090 0030 0030 0030 0030 0030 09E6'),
    'KEY_GREEN': ('Green', '0000 0048 0000 0018 00C0 00C0 0030 0030 0030 0030 0030 0090 0030 0090 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0090 0030 0090 0030 0090 0030 0090 0030 0030 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0030 0030 09E6'),
    'KEY_GUIDE': ('Guide', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0090 0030 0090 0030 09E6'),
    'KEY_MENU': ('Menu', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0090 0030 0090 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 09E6'),
    'KEY_LIST': ('DVR List', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0090 0030 0030 0030 09E6'),
    'KEY_LAST': ('LastCh', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0090 0030 0030 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 0090 0030 09E6'),
    'KEY_CHANNELUP': ('Ch+', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 09E6'),
    'KEY_CHANNELDOWN': ('Ch-', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0090 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0030 0030 0090 0030 09E6'),
    'KEY_0': ('0', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0090 0030 0030 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0090 0030 09E6'),
    'KEY_1': ('1', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0090 0030 0090 0030 0090 0030 0030 0030 0090 0030 09E6'),
    'KEY_2': ('2', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 0090 0030 0090 0030 0030 0030 0090 0030 09E6'),
    'KEY_3': ('3', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0090 0030 0090 0030 0030 0030 0090 0030 09E6'),
    'KEY_4': ('4', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0090 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0030 0030 0090 0030 0090 0030 0030 0030 0090 0030 09E6'),
    'KEY_5': ('5', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0090 0030 0030 0030 0090 0030 0030 0030 0090 0030 09E6'),
    'KEY_6': ('6', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0090 0030 0030 0030 0090 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0090 0030 0030 0030 0090 0030 09E6'),
    'KEY_7': ('7', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0030 0030 0090 0030 09E6'),
    'KEY_8': ('8', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0090 0030 0090 0030 0090 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0090 0030 09E6'),
    'KEY_9': ('9', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0090 0030 0090 0030 0030 0030 0030 0030 0090 0030 09E6'),
    'KEY_INPUT': ('Input', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0090 0030 09E6'),
    'KEY_ENTER': ('Enter', '0000 0048 0000 0018 00C0 00C0 0030 0090 0030 0090 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0030 0030 0030 0030 0090 0030 0030 0030 0030 0030 0090 0030 0090 0030 0030 0030 0030 0030 0090 0030 0090 0030 09E6'),
    'KEY_VOLUMEUP': ('Vol+', '0000 0048 0000 0018 00C1 00C2 0031 0091 0031 0091 0031 0030 0031 0091 0031 0091 0031 0030 0031 0030 0031 0030 0031 0030 0031 0030 0031 0091 0031 0030 0031 0030 0031 0091 0031 0030 0031 0030 0031 0091 0031 0091 0031 0091 0031 0091 0031 0091 0031 0030 0031 0895'),
    'KEY_VOLUMEDOWN': ('Vol-', '0000 0048 0000 0018 00C1 00C2 0031 0091 0031 0091 0031 0030 0031 0091 0031 0091 0031 0091 0031 0030 0031 0030 0031 0030 0031 0030 0031 0091 0031 0030 0031 0030 0031 0091 0031 0030 0031 0030 0031 0030 0031 0091 0031 0091 0031 0091 0031 0091 0031 0030 0031 0893'),
    'KEY_MUTE': ('Mute', '0000 0048 0000 0018 00C1 00C2 0031 0091 0031 0091 0031 0030 0031 0091 0031 0091 0031 0030 0031 0091 0031 0030 0031 0030 0031 0030 0031 0091 0031 0030 0031 0030 0031 0091 0031 0031 0031 0030 0031 0091 0031 0030 0031 0091 0031 0091 0031 0091 0031 0030 0031 0893'),
}

class Activity(object):
    def __init__(self):
        pass

class Device(object):
    def __init__(self):
        pass

class RemoteControl(object):
    def __init__(self):
        pass

addr_map = {
    2: (lg_cmds, 'lg'),
    3: (cisco8742_cmds, 'pronto'),
    4: (sony_cmds, 'sony'),
    5: (nec_cmds, 'nec'),
    6: (apple_own_cmds, 'pronto'),
    7: (pan_dvd_cmds, 'panasonic'),
}

class Harmony(hass.Hass):

    def initialize(self):
        self.log("Starting Harmony app")

        self.last_event = None
        self.repcnt = 0
        self.cur_event = None
        self.cur_keys = {}
        self.event_occurred = 0
        self.rephandle = None

        self.listen_event(self.handle_remote_event, 'esphome.receiver_rf', device_id=REMOTE)
        self.listen_event(self.handle_remote_event, 'esphome.receiver_ir', device_id=REMOTE)

    def handle_remote_event(self, event_name, data, kwargs):
        a = data.get('address')
        c = data.get('command')
        m = data.get('mode')
        t = data.get('toggle')
        #b = data.get('nbits') # for Sony
        #d = data.get('data') # for Sony

        #key = self.cur_keys = urc3680_rc6_keys.get((m, a, c))
        #key = self.cur_keys = rm_vl600_8001_keys.get((d, b))
        key = self.cur_keys = urc3680_rc6_keys.get(c)
        #self.log("%s %s %s" % (a, c, key))
        #self.set_textvalue("input_text.remote_command", "%d %s" % (a, key))

        # ignore unknown keypress
        if not key:
            #self.set_textvalue("input_text.remote_command", 'UNKNOWN')
            self.last_event = None
            self.repcnt = 0
            return

        #self.log("%s %s %s %s %s" % (m, a, c, t, key))
        #self.set_textvalue("input_text.remote_command", "%d %s" % (a, key))
        #return

        dev = addr_map.get(a)

        # ignore unknown device
        if not dev:
            self.last_event = None
            self.repcnt = 0
            return

        #self.log("%s _ %s" % ((m, a, c, t), self.last_event))
        # debounce, allow true repeats
        if (m, a, c, t) == self.last_event:
            self.repcnt += 1
            if self.repcnt < 5:
                return
        else:
            self.last_event = (m, a, c, t)
            self.repcnt = 0

        cmds, txfunc = dev
        cmd = cmds.get(key)
        #self.log(cmd[0])
        #self.set_textvalue("input_text.remote_command", "%d %s" % (a, cmd[0]))
        #return
        if cmd:
            if txfunc == 'pronto':
                self.call_service('esphome/esphome_web_bda758_tx_pronto', data=cmd[1])
            elif txfunc == 'lg':
                if self.repcnt == 0:
                    self.call_service('esphome/esphome_web_bda758_tx_lg', data=cmd[1][0], nbits=cmd[1][1], repeat=2, wait=1)
                else:
                    self.call_service('esphome/esphome_web_bda758_tx_lg', data=cmd[1][0], nbits=cmd[1][1], repeat=1, wait=10)
            elif txfunc == 'nec':
                if self.repcnt == 0:
                    self.call_service('esphome/esphome_web_bda758_tx_nec', command=cmd[1])
                else:
                    self.call_service('esphome/esphome_web_bda758_tx_necrep', command=cmd[1], wait=115)
            elif txfunc == 'sony':
                if self.repcnt == 0:
                    self.call_service('esphome/esphome_web_bda758_tx_sony', data=cmd[1][0], nbits=cmd[1][1], repeat=3, wait=10)
                else:
                    self.call_service('esphome/esphome_web_bda758_tx_sony', data=cmd[1][0], nbits=cmd[1][1], repeat=3, wait=115)
                    # Best? self.call_service('esphome/esphome_web_bda758_tx_sony', data=cmd[1][0], nbits=cmd[1][1], repeat=3, wait=115)
        #    self.call_service('esphome/esphome_web_bda758_tx_panasonic', address=0x4004, command=cmd[1])
        #    self.call_service('esphome/esphome_web_bda758_tx_nec', address=0x53AC, command=cmd)
